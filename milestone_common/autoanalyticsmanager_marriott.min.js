document.addEventListener("DOMContentLoaded", function (e) { setTimeout(function () { processAnaylticsRules(), console.log("Auto Data Layer Rules applied") }, 2e3) }); var found = !1; autoDataLayerLog = {}, autDataLayerObjRuleMatched = [], autDataLayerObjRuleNotMatched = [], dataLayerValueObj = null; var Download = { click: function (e) { var n = document.createEvent("MouseEvents"); return n.initMouseEvent("click", !0, !1, self, 0, 0, 0, 0, 0, !1, !1, !1, !1, 0, null), e.dispatchEvent(n) }, encode: function (e) { return "data:application/octet-stream;base64," + btoa(e) }, link: function (e, n) { var t = document.createElement("a"); return t.download = n || self.location.pathname.slice(self.location.pathname.lastIndexOf("/") + 1), t.href = e || self.location.href, t }, save: function (e, n) { this.click(this.link(this.encode(e), n)) } }, customIndexOf = function (e, n, t) { try { var l = -1; if ("" == n || null == n || "undefined" == n || null == n) return -1; for (var a = 0; a < e.length; a++)if ("" != e[a] && null != e[a] && "undefined" != e[a] && n.trimStart(" ").trimEnd(" ").toLowerCase().indexOf(e[a].trimStart(" ").trimEnd(" ").toLowerCase()) >= 0) { l = a; break } return l } catch (e) { return console.log(e), -1 } }; function processAnaylticsRules() { var e = ["a", "button", "input[type=submit]"]; for (var n in e) bindClickEvent(e[n]); isAutoLog() && generateAutoDataLayerLogFile() } function generateAutoDataLayerLogFile() { try { autoDataLayerLog.autDataLayerObjRuleMatched = { autDataLayerObjRuleMatched: autDataLayerObjRuleMatched }, autoDataLayerLog.autDataLayerObjRuleNotMatched = { autDataLayerObjRuleNotMatched: autDataLayerObjRuleNotMatched }; var e = JSON.stringify(autoDataLayerLog); console.log(e), Download.save(e, "autoDataLayerLog.txt") } catch (e) { console.log(e) } } function processElementClickEvent(e) { found = !1, null == e.getAttribute("data-autodatalayer") && null != analyticsRulesObj && null != analyticsRulesObj && "undefined" != analyticsRulesObj && "" != analyticsRulesObj && (null != e.getAttribute("data-autoDLValue") && null != e.getAttribute("data-autoDLValue") ? PushDataLayerFromServerSideKeyWord(e.getAttribute("data-autoDLValue")) : checkDataLayerRules(analyticsRulesObj, e)) } function bindClickEvent(e) { try { for (var n = document.querySelectorAll(e), t = 0, l = n.length; t < l; t++)addClickEventListner(n[t], t) } catch (e) { console.log(e) } } var dataLayerListener = function (e) { processElementClickEvent(e.currentTarget) }; function addClickEventListner(e, n) { e.removeEventListener("click", dataLayerListener, !1), e.addEventListener("click", dataLayerListener, !1), isAutoLog() && (n > 0 && found && (found = !1), processElementClickEvent(e), isAutoLog() && !found && generateAutoLog(!1, e, null)) } function getUrlParameter(e) { e = e.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]"); var n = new RegExp("[\\?&]" + e + "=([^&#]*)").exec(location.search); return null === n ? "" : decodeURIComponent(n[1].replace(/\+/g, " ")) } function checkDataLayerRules(e, n) { try { for (var t in e) { if (found) break; if (e.hasOwnProperty(t)) { var l = e[t]; if (Array.isArray(e[t])) checkDataLayerRules(l, n); else { var a = "", r = "", o = "", u = "", i = "", f = l.matchingText, d = f.split("|"); "href" == l.ruleCondition.toLowerCase() ? i = n.href : "innertext" == l.ruleCondition.toLowerCase() ? "A" == n.tagName ? "A" == n.tagName && n.children.length > 0 && null != n.firstElementChild && "SPAN" == n.firstElementChild.tagName && "" != (i = "" == n.firstElementChild.innerText || null == n.firstElementChild.innerText || null == n.firstElementChild.innerText ? n.lastElementChild.innerText : n.firstElementChild.innerText) && null != i || (i = n.innerText) : "button" == n.tagName.toLocaleLowerCase() && "" == (i = n.value) && (i = n.innerText) : "value" == l.ruleCondition.toLowerCase() && (i = n.value), a = l.eventName, category = l.category, r = l.action, o = l.label, u = l.labelPrefix; var s = n.closest("form"); if ("" != f && null != f && null != f && "undefined" != f) { if (customIndexOf(d, i) >= 0) { if (found = !0, "booking_entrance_main_widget" == l.ruleName.toLowerCase()) { if ("A" == n.tagName && null != n.href && null != n.href && (n.href.indexOf("/#") >= 0 || n.href.indexOf("javascript") >= 0)) { found = !1; continue } if (null != s && null != s && "" != s); else if (!(null != document.getElementsByTagName("header") && document.getElementsByTagName("header").length > 0 && document.getElementsByTagName("header")[0].contains(n))) { found = !1; continue } } else if ("golf_booking_entrance" == l.ruleName.toLowerCase()) { if (!("A" == n.tagName && n.href.indexOf("javascript") < 0 && window.location.href.toLowerCase().indexOf("golf") >= 0)) { found = !1; continue } } else if ("booking_entrance" == l.ruleName.toLowerCase()) { if ("A" == n.tagName && null != n.href && null != n.href && (n.href.indexOf("/#") >= 0 || n.href.indexOf("javascript") >= 0)) { found = !1; continue } } else if ("popup" == l.ruleName.toLowerCase()) { if (!(n.id.indexOf("popup") >= 0 || n.className.indexOf("popup") >= 0)) { found = !1; continue } } else if ("pdf" == l.ruleName.toLowerCase()) { if (null == l.findIn || null == l.findIn || "" == l.findIn || "undefined" == l.findIn || "url" != l.findIn) { found = !1; continue } if (!(null != l.rules && null != l.rules && "undefined" != l.rules && l.rules.length > 0)) { found = !1; continue } for (var c = 0; c < l.rules.length; c++)if (window.location.href.indexOf(l.rules[c].text) >= 0) { u = l.rules[c].labelPrefix; break } } else if ("social_icons" == l.ruleName.toLowerCase()) { if ("" == (m = IsSocialIcons(i, n))) { found = !1; continue } o = m, found = !0 } else if ("outbound_map" == l.ruleName.toLowerCase()) { if (!IsOutBoundMap(n, i)) { found = !1; continue } found = !0 } else if ("outbound_link" == l.ruleName.toLowerCase() && !IsOutBoundLink(n)) { found = !1; continue } } else if ("social_icons" == l.ruleName.toLowerCase()) { var m; if ("" == (m = IsSocialIcons(i, n))) { found = !1; continue } o = m, found = !0 } else if ("outbound_map" == l.ruleName.toLowerCase()) { if (!IsOutBoundMap(n, i)) { found = !1; continue } found = !0 } else if ("outbound_link" == l.ruleName.toLowerCase()) { if (!IsOutBoundLink(n)) { found = !1; continue } found = !0 } } else if ("reviewform" == l.ruleName.toLowerCase()) { if (!isReviewForm(s, "formtype")) { found = !1; continue } found = !0 } else if ("contact_us_form" == l.ruleName.toLowerCase()) { var g = ""; if (null == s) { found = !1; continue } if (null != (g = GetClosestformName(s, "dformId")) && null != g && "" != g && g.indexOf("contact") >= 0) found = !0, o = replaceRFPFormName(o, g); else { if (!(window.location.href.indexOf("contact") >= 0)) { found = !1; continue } null != (g = getRFPFromNameByName("contact")) && "" != g && null != g && (found = !0, o = replaceRFPFormName(o, g)) } } else if ("newsletter_signup" == l.ruleName.toLowerCase()) { g = ""; if (null == (g = GetClosestformName(s, "dformId")) || null == g || "" == g) { found = !1; continue } null != g && "" != g && null != g && (g.indexOf("subscribe") >= 0 || g.indexOf("email subscribe") >= 0 || g.indexOf("email offer") >= 0) && (found = !0, o = replaceRFPFormName(o, g)) } else if ("rfp" == l.ruleName.toLowerCase()) { g = ""; if (null != (g = GetClosestformName(s, "dformId")) && null != g && "" != g) { if (found = !0, null == l.findIn || null == l.findIn || "" == l.findIn || "undefined" == l.findIn || "url" != l.findIn) { found = !1; continue } if (!(null != l.rules && null != l.rules && "undefined" != l.rules && l.rules.length > 0)) { found = !1; continue } for (c = 0; c < l.rules.length; c++)if (g.indexOf(l.rules[c].text) >= 0) { u = l.rules[c].labelPrefix; break } } } else if ("outbound_map" == l.ruleName.toLowerCase()) { if (!IsOutBoundMap(n, i)) { found = !1; continue } found = !0 } else { if ("outbound_link" != l.ruleName.toLowerCase()) { found = !1; continue } if (!IsOutBoundLink(n)) { found = !1; continue } found = !0 } if (found) { if (null != o && null != o && "undefined" != o && null != o && o.indexOf("{{title}}") >= 0) { var L = "", h = getRecursiveParentElement(n, 4); L = null != h ? h.innerText : getURLPathName(), o = o.replace("{{title}}", L) } if (o.indexOf("{{elementText}}") >= 0) { var y = ""; "A" == n.tagName && n.children.length > 0 && null != n.firstElementChild && "SPAN" == n.firstElementChild.tagName && "" != (y = "" == n.firstElementChild.innerText || null == n.firstElementChild.innerText || null == n.firstElementChild.innerText ? n.lastElementChild.innerText : n.firstElementChild.innerText) && null != y && null != y || (y = n.innerText), o = o.replace("{{elementText}}", y) } if (o.indexOf("{{rfpformName}}") >= 0) { g = ""; o = replaceRFPFormName(o, g = GetClosestformName(s, "dformId")) } o.indexOf("{{clickURL}}") >= 0 && (o = o.replace("{{clickURL}}", getURLHostName(n.href))), "" != u && null != u && null != u && null != u && (o = u + o), null != a && "" != a && null != a && "undefined" != a && (a = a.toLocaleLowerCase()), null != category && "" != category && null != category && "undefined" != category && (category = category.toLocaleLowerCase()), null != r && "" != r && null != r && "undefined" != r && (r = r.toLocaleLowerCase()), null != o && "" != o && null != o && "undefined" != o && (o.indexOf("{{clickURL}}") >= 0 && (o = o.replace("{{clickURL}}", getURLHostName(window.location.href))), o.indexOf("{{rfpformName}}") >= 0 && (o = replaceRFPFormName(o, getURLHostName(window.location.href))), o.indexOf("{{elementText}}") >= 0 && (o = o.replace("{{elementText}}", getURLHostName(window.location.href))), o.indexOf("{{title}}") >= 0 && (o = o.replace("{{title}}", getURLHostName(window.location.href)))), "" != o && null != o && null != o || (o = n.innerText), o = o.toLocaleLowerCase(), datalayerObj = { event: a, category: category, action: r, label: o }, isAutoLog() && generateAutoLog(!0, n, datalayerObj), "form submission" != r && PushToGTM_global(datalayerObj); break } } } } } catch (e) { console.log(e) } } function IsSocialIcons(e, n) { var t = ""; return null != e && "" != e && null != e && "undefined" != e && (e.toLowerCase().indexOf("facebook") >= 0 || n.innerText.toLowerCase().indexOf("facebook") >= 0 ? t = "Facebook" : e.toLowerCase().indexOf("linkedin") >= 0 || n.innerText.toLowerCase().indexOf("linkedin") >= 0 ? t = "Linkedin" : e.toLowerCase().indexOf("instagram") >= 0 || n.innerText.toLowerCase().indexOf("instagram") >= 0 ? t = "Instagram" : e.toLowerCase().indexOf("pinterest") >= 0 || n.innerText.toLowerCase().indexOf("pinterest") >= 0 ? t = "Pinterest" : e.toLowerCase().indexOf("twitter") >= 0 || n.innerText.toLowerCase().indexOf("twitter") >= 0 ? t = "Twitter" : e.toLowerCase().indexOf("youtube") >= 0 || n.innerText.toLowerCase().indexOf("youtube") >= 0 ? t = "Youtube" : e.toLowerCase().indexOf("foursquare") >= 0 || n.innerText.toLowerCase().indexOf("foursquare") >= 0 ? t = "Foursquare" : (e.toLowerCase().indexOf("tripadvisor") >= 0 || n.innerText.toLowerCase().indexOf("tripadvisor") >= 0) && (t = "Tripadvisor")), t } function IsOutBoundMap(e, n) { if ("A" == e.tagName && e.href.indexOf("maps") >= 0 || "A" == e.tagName && e.href.indexOf("/tracking/click-location-map.aspx") >= 0 || "" != n && null != n && null != n && "undefined" != n && (n.toLocaleLowerCase().indexOf("maps") >= 0 || n.toLocaleLowerCase().indexOf("get direction") >= 0)) return !0 } function IsOutBoundLink(e) { return "A" == e.tagName && ("" != e.href && null != e.href && !(e.href.indexOf(window.location.host) >= 0) || e.href.indexOf("/tracking") >= 0) && e.href.indexOf("javascript") < 0 } function getURLHostName(e) { try { return new URL(e).hostname } catch (e) { return console.log(e), "" } } function getURLPathName() { try { var e = window.location.pathname, n = ""; if (null != document.getElementById("hdnmilestoneSiteURL") && "" != document.getElementById("hdnmilestoneSiteURL") && null != document.getElementById("hdnmilestoneSiteURL") && (n = document.getElementById("hdnmilestoneSiteURL").value), window.location.pathname.startsWith("/") && (e = window.location.href.replace(n, "")).indexOf("/") >= 0) { var t = e.split("/"); return "" == t[0] ? t[1] : t[0] } return "" == e || "/" == e || e.startsWith("?") ? "HomePage" : "" != e && null != e && null != e && "undefined" != e && e.length > 0 ? e : "" } catch (e) { return console.log(e), "" } } function getRFPFromNameById(e) { try { if ("undefined" == typeof rfpforms) return ""; var n = JSON.parse(rfpforms); if (null == n || null == n || n.length <= 0) return ""; var t = n.filter(function (n) { if (n.formId == e) return n.formName }); if (null != t && t.length > 0) { var l = ""; return null != t && t.length > 0 && null != t[0].formName && (l = t[0].formName.toLocaleLowerCase()), l } return "" } catch (e) { return console.log(e), "" } } function getRFPFromNameByName(e) { try { if ("undefined" == typeof rfpforms) return ""; var n = JSON.parse(rfpforms); if (null != (e = n.filter(function (n) { if (n.formName.toLowerCase().indexOf(e) >= 0) return n.formName })) && e.length > 0) { var t = ""; return null != e && e.length > 0 && null != e[0].formName && (t = e[0].formName.toLocaleLowerCase()), t } return "" } catch (e) { return console.log(e), null } } function PushDataLayerFromServerSideKeyWord(e) { try { null != e && null != e && (dataLayerValueObj = JSON.parse(e), "form submission" != dataLayerValueObj.action ? PushToGTM_global(dataLayerValueObj) : found = !0) } catch (e) { console.log(e) } } function pushRFPFormToDataLayer(e) { try { if ("" != e && null != e && null != e && "undefined" != e) { var n, t, l = "", a = "", r = "", o = "", u = ""; if ("undefined" != typeof analyticsRulesObj && null != analyticsRulesObj && null != analyticsRulesObj.dataLayerRules && analyticsRulesObj.dataLayerRules.length < 0) return; if (null != (n = analyticsRulesObj.dataLayerRules.filter(function (e) { if ("rfp" == e.ruleName) return e })) && null != n && n.length > 0 && (t = n[0]), null != t && null != t && "undefined" != t && (a = t.label, r = t.action, o = t.category, u = t.eventName, null != t.findIn && null != t.findIn && "" != t.findIn && "undefined" != t.findIn && "url" == t.findIn && null != t.rules && null != t.rules && "undefined" != t.rules && t.rules.length > 0)) for (var i = 0; i < t.rules.length; i++)if (e.indexOf(t.rules[i].text) >= 0) { l = t.rules[i].labelPrefix; break } e.toLocaleLowerCase().indexOf("contact") >= 0 ? (a = (t = (n = analyticsRulesObj.dataLayerRules.filter(function (e) { if ("contact_us_form" == e.ruleName.toLowerCase()) return e }))[0]).label, r = t.action, o = t.category, u = t.eventName, l = t.labelPrefix) : (e.toLocaleLowerCase().indexOf("subscribe") >= 0 || e.toLocaleLowerCase().indexOf("email subscribe") >= 0) && (a = (t = (n = analyticsRulesObj.dataLayerRules.filter(function (e) { if ("newsletter_signup" == e.ruleName.toLowerCase()) return e }))[0]).label, r = t.action, o = t.category, u = t.eventName, l = t.labelPrefix), PushToGTM_global({ event: u, category: o, action: r, label: a = l + (a = replaceRFPFormName(a, e)) }) } } catch (e) { console.log(e) } } function GetClosestformName(e, n) { var t = ""; try { if (null != e && null != e && "" != e && null != e.querySelectorAll("input[id='" + n + "']") && e.querySelectorAll("input[id='" + n + "']").length > 0) { var l = e.querySelectorAll("input[id='" + n + "']")[0].value; null != l && "" != l && null != l && "undefined" != l && (t = getRFPFromNameById(l)) } } catch (e) { console.log(e) } return t } function isReviewForm(e, n) { try { if (null != e && null != e && "" != e && null != e.querySelectorAll("input[id='" + n + "']") && e.querySelectorAll("input[id='" + n + "']").length > 0) { var t = e.querySelectorAll("input[id='" + n + "']")[0].value; if (null != t && "" != t && null != t && t.toLowerCase().indexOf("review") >= 0) return !0 } } catch (e) { console.log(e) } return !1 } function IsLTOForm() { return null != document.getElementById("hdnIsLTOPage") && "1" == document.getElementById("hdnIsLTOPage").value } function replaceRFPFormName(e, n) { return null != e && "" != e && null != e ? e.replace("{{rfpformName}}", n) : "" } function sleep(e) { for (var n = (new Date).getTime(), t = 0; t < 1e7 && !((new Date).getTime() - n > e); t++); } function generateAutoLog(e, n, t) { var l = getElementXPath(n), a = { elementTitle: n.innerText, xPath: l, autoDataLayerMatched: e, logValues: t }; e ? autDataLayerObjRuleMatched.push(a) : autDataLayerObjRuleNotMatched.push(a) } function PushToGTM_global(e) { try { isAutoLog() || (console.log(e), e.label && (e.label = e.label.toLowerCase().trim()), "undefined" != typeof dataLayer && dataLayer.push(e)) } catch (e) { console.log(e) } } function isAutoLog() { return "1" == getUrlParameter("isautolog") } function getElementXPath(e) { for (var n = ""; e && 1 == e.nodeType; e = e.parentNode)idx = getElementIdx(e), xname = e.tagName, idx > 1 && (xname += "[" + idx + "]"), n = "/" + xname + n; return n } function getElementIdx(e) { for (var n = 1, t = e.previousSibling; t; t = t.previousSibling)1 == t.nodeType && t.tagName == e.tagName && n++; return n } function stringToArrayBuffer(e) { try { for (var n = new ArrayBuffer(e.length), t = new Uint8Array(n), l = 0, a = e.length; l < a; l++)t[l] = e.charCodeAt(l); return n } catch (e) { return console.log(e), null } } function getRecursiveParentElement(e, n) { try { for (var t = 0, l = null, a = null; t < n;) { if (0 == t ? (null == a && (a = e), a = getParentElement(a)) : a = getParentElement(a), null != a.querySelectorAll("h1") && a.querySelectorAll("h1").length > 0) { l = a.querySelectorAll("h1")[a.querySelectorAll("h1").length - 1]; break } if (null != a.querySelectorAll("h2") && a.querySelectorAll("h2").length > 0) { l = a.querySelectorAll("h2")[a.querySelectorAll("h2").length - 1]; break } t++ } return l } catch (e) { return console.log(e), null } } function getParentElement(e) { try { return e.parentElement } catch (e) { return console.log(e), null } } var oldXHR = window.XMLHttpRequest; function newXHR() { var e = new oldXHR; return e.addEventListener("readystatechange", function () { 4 == e.readyState && 200 == e.status && found && (e.responseURL.indexOf("submitformdata.ashx") >= 0 || e.responseURL.indexOf("api/BookingReminderApi/InsertBookingReminder") >= 0) && e.responseText.toLocaleLowerCase().indexOf("true") >= 0 && ("undefined" != typeof datalayerObj && null != datalayerObj && null != datalayerObj ? PushToGTM_global(datalayerObj) : "undefined" != typeof dataLayerValueObj && null != dataLayerValueObj && null != dataLayerValueObj && PushToGTM_global(dataLayerValueObj)) }), e } window.XMLHttpRequest = newXHR;